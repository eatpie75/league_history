// Generated by CoffeeScript 1.3.3
(function() {
  var TellMeMore,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  TellMeMore = (function() {

    function TellMeMore() {
      this.game = window.game_pk;
      this.cache = {};
      this.bind();
    }

    TellMeMore.prototype.bind = function() {
      var _this_;
      _this_ = this;
      return $('.player_expand').click(function(e) {
        return _this_.expand($(this));
      });
    };

    TellMeMore.prototype.bind_toggle = function(el, extra, expand) {
      var _this_;
      if (expand == null) {
        expand = 1;
      }
      _this_ = this;
      el.unbind();
      return $(el).click(function(e) {
        if (expand) {
          return _this_.expand($(this));
        } else {
          return _this_.collapse($(this), extra);
        }
      });
    };

    TellMeMore.prototype.info_template = _.template("<tr><td colspan=6 style='position:relative;'>			<div class='span4'>				<div style='border-bottom:1px solid #ddd;' class='span2'>					Minion Kills:				</div>				<div style='border-bottom:1px solid #ddd;' class='span2 pull-right'>					<%= minion_kills %>				</div>			</div>		</td></tr>");

    TellMeMore.prototype.get_info = function(player) {
      var _ref,
        _this = this;
      if (_ref = "" + player, __indexOf.call(_.keys(this.cache), _ref) < 0) {
        $.ajax({
          type: 'GET',
          async: false,
          url: "/ajax/player_info/" + player + "/",
          dataType: "json",
          success: function(msg) {
            return _this.cache[player] = msg;
          }
        });
      }
      return this.cache[player];
    };

    TellMeMore.prototype.expand = function(el) {
      var extra, info, player;
      player = el.data('player');
      info = this.get_info(player);
      extra = $(this.info_template(info)).insertAfter(el.closest('tr'));
      return this.bind_toggle(el, extra, 0);
    };

    TellMeMore.prototype.collapse = function(el, extra) {
      extra.remove();
      return this.bind_toggle(el);
    };

    return TellMeMore;

  })();

  $(document).ready(function() {
    return window.tell_me_more = new TellMeMore();
  });

}).call(this);
