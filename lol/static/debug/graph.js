// Generated by CoffeeScript 1.9.3
(function() {
  var draw_chart, tier_colors, tier_goals;

  tier_goals = {
    1: [100, 200, 300, 400],
    2: [500, 600, 700, 800, 900],
    3: [1000, 1100, 1200, 1300, 1400],
    4: [1500, 1600, 1700, 1800, 1900],
    5: [2000, 2100, 2200, 2300, 2400],
    6: [2500, 2551]
  };

  tier_colors = {
    1: ['#866500', '#866500', '#866500', '#866500'],
    2: ['#9a9a9a', '#9a9a9a', '#9a9a9a', '#9a9a9a', '#9a9a9a'],
    3: ['#ffca2a', '#ffca2a', '#ffca2a', '#ffca2a', '#ffca2a'],
    4: ['#52a2ab', '#52a2ab', '#52a2ab', '#52a2ab', '#52a2ab'],
    5: ['#00c068', '#00c068', '#00c068', '#00c068', '#00c068'],
    6: ['#c30b0b', '#c30b0b']
  };

  draw_chart = function(data, kwargs) {
    var _chistorywr_hover, _lcs_hover, _lcs_num_reverser, append_colors, append_goals, champion, chart_defaults, chart_options, colors, data_defaults, data_options, day, goals, high, high_rank, high_tier, i, j, k, l, len, len1, len2, len3, len4, low, low_rank, low_tier, m, n, parsed, prefix_colors, prefix_goals, ref, ref1, x;
    if (kwargs == null) {
      kwargs = {};
    }
    _chistorywr_hover = function(index, options) {
      return "<b>" + options.data[index]['x'] + "</b><br>" + options.data[index]['y'] + "% Winrate<br>Played " + options.data[index]['count'] + " times";
    };
    _lcs_num_reverser = function(lcs) {
      var division, rank, tier;
      tier = Math.floor(lcs / 500) + 1;
      division = Math.floor((lcs - (tier - 1) * 500) / 100);
      rank = 100 - Math.floor(lcs - (tier - 1) * 500 - division * 100);
      if (tier === 6) {
        division = 4;
        rank -= 50;
      }
      return {
        'tier': tier,
        'division': 5 - division,
        'rank': rank
      };
    };
    _lcs_hover = function(index, options) {
      data = options.data[index];
      return JSON.stringify(_lcs_num_reverser(data['y']));
    };
    chart_defaults = {
      type: 'Line',
      element: 'elo-graph',
      xkey: 'x',
      ykeys: 'y',
      labels: ['ELO'],
      ymax: 'auto',
      ymin: 'auto',
      hideHover: true,
      lineColors: ['#3269b4', '#C0D800', '#CB4B4B', '#4DA74D', '#9440ED']
    };
    data_defaults = {
      y: 'rating',
      data_parse: 'default',
      graph_begin_date: new Date('2010-01-01')
    };
    chart_options = $.extend(true, {}, chart_defaults, kwargs.chart_options);
    data_options = $.extend(true, {}, data_defaults, kwargs.data_options);
    parsed = [];
    if (chart_options.type === 'Line' && data_options.data_parse === 'default') {
      for (i = 0, len = data.length; i < len; i++) {
        day = data[i];
        if (day[1][data_options.y] < 10) {
          continue;
        }
        parsed.push({
          'x': day[0],
          'y': day[1][data_options.y]
        });
      }
    } else if (chart_options.type === 'Line' && data_options.data_parse === 'chistorywr') {
      chart_options.hoverCallback = _chistorywr_hover;
      for (j = 0, len1 = data.length; j < len1; j++) {
        day = data[j];
        if (day[1]['champions'][data_options.y]['count'] < 20) {
          continue;
        }
        parsed.push({
          'x': day[0],
          'y': Math.round((day[1]['champions'][data_options.y]['won'] / day[1]['champions'][data_options.y]['count']) * 100),
          'count': day[1]['champions'][data_options.y]['count']
        });
      }
    } else if (chart_options.type === 'Line' && data_options.data_parse === 'chistorypop') {
      for (k = 0, len2 = data.length; k < len2; k++) {
        day = data[k];
        if (day[1]['champions'][data_options.y]['count'] < 10) {
          continue;
        }
        parsed.push({
          'x': day[0],
          'y': (day[1]['champions'][data_options.y]['won'] / day[1]['count']) * 100
        });
      }
    } else if (chart_options.type === 'Line' && data_options.data_parse === 'lcs' && data.length > 2) {
      chart_options.hoverCallback = _lcs_hover;
      chart_options.yLabelFormat = function(x) {
        return '';
      };
      chart_options.grid = false;
      low = 2600;
      high = 0;
      for (l = 0, len3 = data.length; l < len3; l++) {
        day = data[l];
        if (day[1]['avg'] > high) {
          high = day[1]['avg'];
        }
        if (day[1]['avg'] < low) {
          low = day[1]['avg'];
        }
        parsed.push({
          'x': day[0],
          'y': day[1]['avg']
        });
      }
      low_rank = _lcs_num_reverser(low);
      high_rank = _lcs_num_reverser(high);
      low_tier = low_rank['tier'];
      high_tier = high_rank['tier'];
      goals = [];
      colors = [];
      prefix_goals = [];
      append_goals = [];
      prefix_colors = [];
      append_colors = [];
      for (x = m = ref = low_tier, ref1 = high_tier; ref <= ref1 ? m <= ref1 : m >= ref1; x = ref <= ref1 ? ++m : --m) {
        goals = goals.concat(tier_goals[x]);
        colors = colors.concat(tier_colors[x]);
      }
      if (low_tier === high_tier) {
        if (low_tier !== 1) {
          prefix_goals = prefix_goals.concat(tier_goals[low_tier - 1].slice(-1));
          prefix_colors = prefix_colors.concat(tier_colors[low_tier - 1].slice(-1));
        }
        if (low_tier !== 6) {
          append_goals = append_goals.concat(tier_goals[low_tier + 1][0]);
          append_colors = append_colors.concat(tier_colors[low_tier + 1][0]);
        }
      } else {
        if (high_tier !== 6) {
          append_goals = append_goals.concat(tier_goals[high_tier + 1][0]);
          append_colors = append_colors.concat(tier_colors[high_tier + 1][0]);
        }
      }
      chart_options.goals = [].concat(prefix_goals, goals, append_goals);
      chart_options.goalLineColors = [].concat(prefix_colors, colors, append_colors);
      chart_options.goalStrokeWidth = 2;
    } else if (chart_options.type === 'Donut' && data_options.data_parse === 'default') {
      chart_options.colors = ['#D676E5', '#B15CBF', '#8D4299', '#692873', '#450F4E', '#88ACDE', '#6B8CBA', '#4F6D97', '#324E73', '#162F50'];
      for (n = 0, len4 = data.length; n < len4; n++) {
        champion = data[n];
        parsed.push({
          'label': window.STATIC_URL + "img/champions/" + champion['champion_id'] + ".png",
          'value': champion[data_options.y],
          'blue_team': champion.blue_team
        });
      }
      parsed.sort(function(a, b) {
        if (a.blue_team && !b.blue_team) {
          return 1;
        } else if (!a.blue_team && b.blue_team) {
          return -1;
        } else if (a.value > b.value) {
          return 1;
        } else if (a.value < b.value) {
          return -1;
        } else {
          return 0;
        }
      });
    }
    chart_options['data'] = parsed;
    window.drawn_chart = Morris[chart_options['type']](chart_options);
    return [data_options, chart_options];
  };

  $(document).ready(function() {
    var i, i_chart, len, ref, results;
    window.draw_chart = draw_chart;
    if (window.chart != null) {
      if (Array.isArray(window.chart)) {
        ref = window.chart;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          i_chart = ref[i];
          results.push(draw_chart(window.chart_data, i_chart));
        }
        return results;
      } else {
        return draw_chart(window.chart_data, window.chart);
      }
    }
  });

}).call(this);
