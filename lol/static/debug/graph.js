// Generated by CoffeeScript 1.4.0
(function() {
  var draw_chart;

  draw_chart = function(data, kwargs) {
    var chart_defaults, chart_options, data_defaults, data_options, date, day, now, parsed, _chistorywr_hover, _i, _j, _k, _l, _len, _len1, _len2, _len3;
    if (kwargs == null) {
      kwargs = {};
    }
    _chistorywr_hover = function(index, options) {
      return "<b>" + options.data[index]['x'] + "</b><br>" + options.data[index]['y'] + "% Winrate<br>Played " + options.data[index]['count'] + " times";
    };
    chart_defaults = {
      element: 'elo-graph',
      xkey: 'x',
      ykeys: 'y',
      labels: ['ELO'],
      ymax: 'auto',
      ymin: 'auto',
      hideHover: true,
      lineColors: ['#3269b4', '#C0D800', '#CB4B4B', '#4DA74D', '#9440ED']
    };
    data_defaults = {
      y: 'rating',
      data_parse: 'default',
      graph_begin_date: new Date('2010-01-01')
    };
    chart_options = $.extend(true, {}, chart_defaults, kwargs.chart_options);
    data_options = $.extend(true, {}, data_defaults, kwargs.data_options);
    parsed = [];
    if (data_options.data_parse === 'default') {
      for (_i = 0, _len = data.length; _i < _len; _i++) {
        day = data[_i];
        if (day[1][data_options.y] < 10) {
          continue;
        }
        parsed.push({
          'x': day[0],
          'y': day[1][data_options.y]
        });
      }
    } else if (data_options.data_parse === 'elo') {
      for (_j = 0, _len1 = data.length; _j < _len1; _j++) {
        day = data[_j];
        if (day[1][data_options.y] < 10 || new Date(day[0]) < data_options.graph_begin_date) {
          continue;
        }
        parsed.push({
          'x': day[0],
          'y': day[1][data_options.y]
        });
      }
    } else if (data_options.data_parse === 'chistorywr') {
      chart_options.hoverCallback = _chistorywr_hover;
      for (_k = 0, _len2 = data.length; _k < _len2; _k++) {
        day = data[_k];
        date = new Date(day[0]);
        now = new Date();
        if (day[1]['champions'][data_options.y]['count'] < 20) {
          continue;
        }
        parsed.push({
          'x': day[0],
          'y': Math.round((day[1]['champions'][data_options.y]['won'] / day[1]['champions'][data_options.y]['count']) * 100),
          'count': day[1]['champions'][data_options.y]['count']
        });
      }
    } else if (data_options.data_parse === 'chistorypop') {
      for (_l = 0, _len3 = data.length; _l < _len3; _l++) {
        day = data[_l];
        if (day[1]['champions'][data_options.y]['count'] < 10) {
          continue;
        }
        parsed.push({
          'x': day[0],
          'y': (day[1]['champions'][data_options.y]['won'] / day[1]['count']) * 100
        });
      }
    }
    chart_options['data'] = parsed;
    window.drawn_chart = Morris.Line(chart_options);
    return [data_options, chart_options];
  };

  $(document).ready(function() {
    window.draw_chart = draw_chart;
    if (window.chart != null) {
      return draw_chart(window.chart_data, window.chart);
    }
  });

}).call(this);
