// Generated by CoffeeScript 1.4.0
(function() {
  var TellMeMore,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  TellMeMore = (function() {

    function TellMeMore() {
      this.game = window.game_pk;
      this.cache = {};
      this.bind();
    }

    TellMeMore.prototype.bind = function() {
      var _this_;
      _this_ = this;
      return $('.player_expand').click(function(e) {
        return _this_.expand($(this));
      });
    };

    TellMeMore.prototype.bind_toggle = function(el, extra, expand) {
      var _this_;
      if (expand == null) {
        expand = 1;
      }
      _this_ = this;
      el.unbind();
      return $(el).click(function(e) {
        if (expand) {
          return _this_.expand($(this));
        } else {
          return _this_.collapse($(this), extra);
        }
      });
    };

    TellMeMore.prototype.info_template = function(args) {
      return "<td colspan=11>			<div class='span3'>				<b>Physical/Magical Damage</b><br>				<div class='hori-bar centered'>					<div class='red' title='Physical Damage' style='width:" + ((args.physical_damage_dealt / args.damage_dealt) * 100) + "%;'></div>					<div class='blue' title='Magical Damage' style='width:" + (100 - (args.physical_damage_dealt / args.damage_dealt) * 100) + "%;'></div>				</div>			</div>			<div class='span3'>				<b>Sight/Vision wards bought</b><br>				" + args.sight_wards_bought_in_game + "/" + args.vision_wards_bought_in_game + "			</div>		</td>";
    };

    TellMeMore.prototype.get_info = function(player) {
      var _ref,
        _this = this;
      if (_ref = "" + player, __indexOf.call(Object.keys(this.cache), _ref) < 0) {
        $.ajax({
          type: 'GET',
          async: false,
          url: "" + window.AJAX_BASE + "ajax/player_info/" + player + "/",
          dataType: "json",
          success: function(msg) {
            return _this.cache[player] = msg;
          }
        });
      }
      return this.cache[player];
    };

    TellMeMore.prototype.expand = function(el) {
      var extra, info, player,
        _this = this;
      player = el.data('player');
      info = this.get_info(player);
      extra = $("<tr class='drop-stats'></tr>").insertAfter(el.closest('tr'));
      extra.css('height');
      extra.css('height', '100px');
      setTimeout(function() {
        return extra.html(_this.info_template(info));
      }, 210);
      return this.bind_toggle(el, extra, 0);
    };

    TellMeMore.prototype.collapse = function(el, extra) {
      var _this = this;
      extra.html('');
      extra.css('height', '0px');
      setTimeout(function() {
        return extra.remove();
      }, 500);
      return this.bind_toggle(el);
    };

    return TellMeMore;

  })();

  $(document).ready(function() {
    return window.tell_me_more = new TellMeMore();
  });

}).call(this);
